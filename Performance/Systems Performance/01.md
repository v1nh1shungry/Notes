## 系统性能

* 在系统性能领域，**全栈**指的是从应用程序到硬件的整个软件栈，包括系统库、内核和硬件本身。

## 活动

* 软件项目从构思到开发再到生产部署的理想步骤：
  1. 设置性能目标和建立模型；
  2. 基于软件或硬件模型进行性能特征归纳；
  3. 在测试环境中进行性能分析；
  4. 对新版本做非回归性测试；
  5. 针对发布版本的基准测试；
  6. 在目标生产环境中的 Proof-of-concept 测试；
  7. 在生产环境中进行性能调优；
  8. 监测生产环境中运行的软件；
  9. 对生产环境中出现的问题进行性能分析；
  10. 回顾总结生产环境中的问题；
  11. 开发性能工具以加强生产环境分析；
* 云计算能帮助直接在目标生产环境进行性能测试：
  * **金丝雀测试**：即只在生产环境中的一部分实例中部署新软件来进行测试。
  * **蓝-绿部署**：即同时维护两份环境：“蓝环境”是当前稳定运行的版本，”绿环境“是即将发布的新版本；发布时，将流量路由至新版本，如果出现任何问题就马上回滚至旧版本。

## 延时

* 广义上可以概括为完成一个操作所需的耗时。
* 非常适合用来量化性能的指标。
* 可以用来估计最大增速（speedup）。

## 可观测性

可观测性工具指通过观测、监测来理解系统的工具，包括计数器、跟踪器等。基准测试工具指通过运行特定的工作负载实验来理解系统的工具。

由于基准测试可能会争夺资源进而扰乱生产环境，在生产环境中应优先使用可观测性工具，在测试环境中才使用基准测试。

### 计数器、统计数据和指标

* **计数器**指**应用程序或内核**提供的关于其状态和活动的数据，如操作计数、延时、资源利用率等。
* **统计数据**指**性能工具**在不同时间读取计数器计算出数据，如随时间变化的比率、平均值、百分比等。
* **指标**指**性能监控工具**为监测某一个目标而选择的统计数据。
* 最后，**性能监控工具**在指标异常时可以向用户发出**警告**。

### 剖析

* 指使用工具对系统进行采样来理解系统的方法。
  * CPU 是常见的剖析对象，常用方法是对 CPU 上执行的代码路径进行时间采样。
  * 火焰图是 CPU 剖析的一种可视化形式。

### 跟踪

#### 静态跟踪

* 指添加到源代码中硬编码的软件检测点。
* 内核中有数百个，分别用于检测磁盘 IO 、调度事件、系统调用等，称为 tracepoint。
* 针对用户空间软件的静态检测称为 USDT，常用被软件库（如 libc）用于检测库调用。
* 适用于检测容易被其他观测工具（如 top）遗漏的**短命进程**。
